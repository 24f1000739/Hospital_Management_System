{% extends "base.html" %}
{% block title %}Patient Dashboard{% endblock %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h4 mb-0">Welcome {{ g.user.full_name }}</h1>
    <div>
      <a href="{{ url_for('edit_profile') }}" class="btn btn-link" style="text-decoration: none;">edit profile</a>
      <span class="text-muted">|</span>
      <a href="{{ url_for('patient_history_view') }}" class="btn btn-link" style="text-decoration: none;">History</a>
      <span class="text-muted">|</span>
      <a href="{{ url_for('logout') }}" class="btn btn-link" style="text-decoration: none;">logout</a>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <h2 class="h6 mb-0">Departments</h2>
    </div>
    <div class="card-body">
      <div class="row g-3">
        {% for dept in departments %}
          <div class="col-md-4">
            <div class="card">
              <div class="card-body">
                <h3 class="h6">{{ dept.name }}</h3>
                <a href="{{ url_for('department_detail', dept_id=dept.id) }}" class="btn btn-sm btn-primary">view details</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header">
      <h2 class="h6 mb-0">Upcoming Appointments</h2>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Sr No.</th>
              <th>Doctor Name</th>
              <th>Deptt</th>
              <th>Date</th>
              <th>Time</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for appt in upcoming %}
              <tr>
                <td>{{ 1000 + loop.index }}. </td>
                <td>Dr. {{ appt.doctor.full_name }}</td>
                <td>{{ appt.doctor.department.name.lower() if appt.doctor.department else 'general' }}</td>
                <td>{{ appt.appointment_date.strftime('%d/%m/%Y') }}</td>
                <td>{{ appt.slot_label }}</td>
                <td>
                  {% if appt.status == 'Booked' %}
                    <form method="post" action="{{ url_for('patient_appointment_actions') }}" class="d-inline">
                      <input type="hidden" name="appointment_id" value="{{ appt.id }}">
                      <input type="hidden" name="action" value="cancel">
                      <button type="submit" class="btn btn-sm btn-outline-danger">cancel</button>
                    </form>
                  {% else %}
                    <span class="badge text-bg-secondary">{{ appt.status }}</span>
                  {% endif %}
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="6" class="text-center text-muted">No upcoming appointments.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}
