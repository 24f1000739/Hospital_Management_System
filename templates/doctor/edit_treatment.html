{% extends "base.html" %}
{% block title %}Edit Treatment Record{% endblock %}
{% block content %}
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
        <h2 class="h6 mb-0">Edit Treatment Record</h2>
        <a href="{{ url_for('view_patient_history_full', patient_id=appointment.patient_id) }}" class="btn btn-sm btn-outline-secondary">Back</a>
      </div>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <p class="mb-1"><strong>Patient Name:</strong> {{ appointment.patient.full_name }}</p>
        <p class="mb-1"><strong>Doctor Name:</strong> Dr. {{ appointment.doctor.full_name }}</p>
        <p class="mb-1"><strong>Department:</strong> {{ appointment.doctor.department.name if appointment.doctor.department else 'General' }}</p>
        <p class="mb-1"><strong>Appointment Date:</strong> {{ appointment.appointment_date.strftime('%d/%m/%Y') }}</p>
        <p class="mb-3"><strong>Appointment Time:</strong> {{ appointment.slot_label }}</p>
      </div>
      <form method="post">
        <div class="mb-3">
          <label class="form-label">Visit Type</label>
          <input type="text" name="visit_type" class="form-control" value="{{ appointment.treatment_record.visit_type if appointment.treatment_record and appointment.treatment_record.visit_type else '' }}" placeholder="e.g., In-person, Follow-up">
        </div>
        <div class="mb-3">
          <label class="form-label">Test Done</label>
          <textarea name="test_done" class="form-control" rows="2" placeholder="List tests performed">{{ appointment.treatment_record.test_done if appointment.treatment_record and appointment.treatment_record.test_done else '' }}</textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Diagnosis</label>
          <textarea name="diagnosis" class="form-control" rows="4" placeholder="Enter diagnosis...">{{ appointment.treatment_record.diagnosis if appointment.treatment_record and appointment.treatment_record.diagnosis else '' }}</textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Prescription</label>
          <textarea name="prescription" class="form-control" rows="4" placeholder="Enter prescription details...">{{ appointment.treatment_record.prescription if appointment.treatment_record and appointment.treatment_record.prescription else '' }}</textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Medicines</label>
          <textarea name="medicines" class="form-control" rows="3" placeholder="Medicine 1 1-0-1&#10;Medicine 2 0-1-1&#10;Medicine 3 1-0-0">{{ appointment.treatment_record.medicines if appointment.treatment_record and appointment.treatment_record.medicines else '' }}</textarea>
          <small class="text-muted">Enter each medicine on a new line. Format: Medicine Name Dosage (e.g., 1-0-1 means morning-afternoon-night)</small>
        </div>
        <div class="mb-3">
          <label class="form-label">Notes</label>
          <textarea name="notes" class="form-control" rows="3" placeholder="Additional notes...">{{ appointment.treatment_record.notes if appointment.treatment_record and appointment.treatment_record.notes else '' }}</textarea>
        </div>
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Update Record</button>
          <a href="{{ url_for('view_patient_history_full', patient_id=appointment.patient_id) }}" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
{% endblock %}

